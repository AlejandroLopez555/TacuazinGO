@{
    ViewData["Title"] = "Registrar Gasto";
}

<div class="container">
    <h1> Registrar Gasto</h1>

    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5> Nuevo Gasto</h5>
                </div>
                <div class="card-body">
                    <form id="formGasto">
                        <div class="mb-3">
                            <label class="form-label">Descripción *</label>
                            <input type="text" class="form-control" id="descripcion" required
                                   placeholder="Ingresa el motivo de tu gasto">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Monto *</label>
                            <input type="number" step="0.01" class="form-control" id="monto" required
                                   placeholder="0.00">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Categoría</label>
                            <select class="form-select" id="categoria">
                                <option value="">Seleccionar categoría...</option>
                                <option value="Servicios">Servicios (Luz, Agua, Internet)</option>
                                <option value="Alquiler">Alquiler</option>
                                <option value="Materiales">Materiales/Insumos</option>
                                <option value="Nómina">Nomina/Salarios</option>
                                <option value="Transporte">Transporte</option>
                                <option value="Otros">Otros</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Fecha</label>
                            <input type="date" class="form-control" id="fecha"
                                   value="@DateTime.Now.ToString("yyyy-MM-dd")">
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-warning">
                                 Registrar Gasto
                            </button>
                            <a href="/" class="btn btn-secondary">← Volver al Dashboard</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('formGasto').addEventListener('submit', async function(e) {
            e.preventDefault();

            const gasto = {
                descripcion: document.getElementById('descripcion').value,
                monto: parseFloat(document.getElementById('monto').value),
                categoria: document.getElementById('categoria').value,
                fecha: document.getElementById('fecha').value
            };

            try {
                const response = await fetch('/api/GastosApi', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(gasto)
                });

                if (response.ok) {
                    alert('✅ Gasto registrado exitosamente!');
                    document.getElementById('formGasto').reset();
                    document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
                } else {
                    const error = await response.text();
                    alert('❌ Error: ' + error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('❌ Error de conexión');
            }
        });
    </script>
}